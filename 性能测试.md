# 性能测试

标签（空格分隔）： istio 性能测试

---

## K8S下Nginx性能测试

|vCPU    |线程数 |连接数|测试时间|平均延迟|90延迟 |99延迟  |最大延迟 |  QPS  | CPU使用率|
|:----:  |:----: |:----:|:----:  | :----: |:----: | :----: | :----:  | :----:|:----:|
|2*2vCPU |4      |64    |20s     |40.34ms|77.75ms |125.92ms|170.16ms |1669.30|  60 |
|2*2vCPU |5      |64    |20s     |38.07ms|74.08ms |119.56ms|185.69ms |1648.99|  60 |


## Istio下Nginx性能测试

|vCPU    |线程数 |连接数|测试时间|平均延迟|90延迟 |99延迟  |最大延迟 |  QPS  | CPU使用率|
|:----:  |:----: |:----:|:----:  | :----: |:----: | :----: | :----:  | :----:|:----:|
|2*2vCPU |4      |64    |20s     |40.34ms|77.75ms |125.92ms|170.16ms |1669.30|
|2*2vCPU |5      |64    |20s     |38.07ms|74.08ms |119.56ms|185.69ms |1648.99|



|环境  |应用|vCPU    |线程数 |连接数|测试时间|平均延迟|90延迟 |99延迟  |最大延迟 |  QPS  | CPU使用率|policy|telemetry|pilot|proxy(Envoy)|
|:----:|:----:|:----:  |:----: |:----:|:----:  | :----: |:----: | :----: | :----:  | :----:|:----:|:----:|:----:|:----:|:----:|
|K8S   |Nginx|2*2vCPU |4      |12    |90s     |1.054ms|1.486ms |3.166ms|73.924ms |11813|60.8|
|NoMixer|Nginx|2*2vCPU |2|10|120s|3.19ms|4.71ms|9.625ms|160.58ms |3259|62.5|||0.016|1.0205|
|ISTIO|Nginx|2*2vCPU |2|10|120s|7.36ms|16.20ms|35.16ms|152.39ms |1674|55.5|0.0045|0.8525|0.0115|0.6255|



问题：
policy、telemetry pod集中于同一个节点，同时该节点又是工作节点，导致本节点负载过大，影响性能，极端情况下该节点使用率达到100%，另一个工作节点才只到50%，telemetry、policy消耗CPU程度反常降低，表示已经达到了性能极限，但是另一个节点并没有完全使用。这两个组件在初始化时会随机选择一个节点，应该对这两个组件的节点进行限制。